---
layout: post
status: publish
published: true
title: Exporting DataView with Custom Parameter
author:
  display_name: bryan
  login: bryan
  email: bryan.napier.md@gmail.com
  url: ''
author_login: bryan
author_email: bryan.napier.md@gmail.com
wordpress_id: 11
wordpress_url: http://blog.ofonesandzeros.com/2007/05/30/exporting-dataview-with-custom-parameter/
date: '2007-05-30 11:31:02 -0400'
date_gmt: '2007-05-30 15:31:02 -0400'
categories:
- SharePoint
tags: []
comments: []
---
<p>This past week I have been working with a DataView that needed to filter a list by the title of the PublishingPage containing the DataView web part.&nbsp; In order to provide this functionality, I created&nbsp;a straight-forward custom parameter:</p>
<p><span style="COLOR: #0000ff">public</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">class</span><span style="COLOR: #000000"> PageTitleParameter : System.Web.UI.WebControls.Parameter<br />{<br />&nbsp;&nbsp;&nbsp; </span><span style="COLOR: #0000ff">protected</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">override</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">object</span><span style="COLOR: #000000"> Evaluate(System.Web.HttpContext context, System.Web.UI.Control control)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SPListItem listItem </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> SPContext.Current.ListItem;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000"> (listItem </span><span style="COLOR: #000000">!=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: #0000ff">try</span><span style="COLOR: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> listItem.Title;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: #0000ff">catch</span><span style="COLOR: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000">.Empty;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000">.Empty;<br />&nbsp;&nbsp;&nbsp; }<br />}</span></p>
<p><span style="COLOR: #000000">Creating custom Parameters has <a href="http://weblogs.asp.net/scottgu/archive/2006/01/23/436276.aspx">been covered elsewhere</a>, so I won&rsquo;t bother going into that, it works pretty much the same in SharePoint as in any ASP.NET application.&nbsp; Where things get different, is after you export your shiny-new DataView web part to SharePoint.&nbsp; If your experience is anything like mine, when you add your web part to a page instead of seeing your rendered DataView, you see&nbsp;&ldquo;Parsing Error:&nbsp; Object reference not set to an instance of an object&rdquo;.</span></p>
<p><span style="COLOR: #000000">So what went wrong?&nbsp; If you look carefully at the parser error, you will likely see that the TagPrefix that you setup when you registered your custom parameter in SharePoint Designer has been replaced with something like &ldquo;cc3&rdquo;, &ldquo;cc4&rdquo;, etc.&nbsp; In order to fix this, instead of exporting the web part from SPD straight into SharePoint, save it to a file first.&nbsp; Open the .webpart file that you saved and add your @Register directive for &ldquo;cc3&rdquo; or &ldquo;cc4&rdquo; or whatever your custom parameter&rsquo;s TagPrefix happened to become.&nbsp; You can now go into the Web Part Gallery and upload your web part.&nbsp; </span></p>
<p><span style="COLOR: #000000">Good luck!</span></p>
