---
layout: post
status: publish
published: true
title: Programmatically Add ListViewWebPart with Customized View
author: Bryan Napier
author_login: bryan
author_email: bryan.napier.md@gmail.com
wordpress_id: 205
wordpress_url: http://www.ofonesandzeros.com/?p=205
date: '2011-06-15 22:08:35 -0400'
date_gmt: '2011-06-16 02:08:35 -0400'
categories:
- Programming
- SharePoint
tags:
- SharePoint
comments:
- id: 58
  author: Imran
  author_email: infoimran@gmail.com
  author_url: ''
  date: '2012-01-20 11:36:54 -0500'
  date_gmt: '2012-01-20 11:36:54 -0500'
  content: |-
    Nice,
    But i want to warp a listview webpart in usercontrol,so that it my connect to another webpart using connected webpart.

    how is possible,i need help.

    Thanx in advance.

    Regard
    Imran
- id: 59
  author: bryan
  author_email: bryan.napier.md+blog@gmail.com
  author_url: ''
  date: '2012-01-20 13:25:53 -0500'
  date_gmt: '2012-01-20 13:25:53 -0500'
  content: |-
    Imran,

    Could you elaborate on what your business requirements are, and what your current technical solution is?

    Thanks!

    -Bryan
- id: 60
  author: Ram
  author_email: ramsharma121@gmail.com
  author_url: ''
  date: '2012-03-23 06:54:57 -0400'
  date_gmt: '2012-03-23 06:54:57 -0400'
  content: |-
    Hi Briyan,

    Thnks for this article, Can you please help me in a similar scaniro, I have created a custom view "MyRequest" of the calendar list, now I want to add a filter webpart to that page on which this view is present.

    Thanks,
    Ram
- id: 61
  author: mj
  author_email: juluri.mridula@gmail.com
  author_url: ''
  date: '2012-06-08 06:26:29 -0400'
  date_gmt: '2012-06-08 06:26:29 -0400'
  content: |-
    Hi Briyan,

    I  just want to get the selected items in the XSLTListview webpart programatically, please help me.................

    Regards,
    MJ
- id: 191
  author: Dawn
  author_email: dawnfielden@hotmail.com
  author_url: ''
  date: '2013-01-23 13:53:49 -0500'
  date_gmt: '2013-01-23 13:53:49 -0500'
  content: This is awesome - I was just about there when I stumbled across your post
    - brilliant thanks
- id: 679
  author: 'Resources: SharePoint WebPart(s) | lionadi'
  author_email: ''
  author_url: http://lionadi.wordpress.com/2013/03/18/resources-sharepoint-webparts/
  date: '2013-03-18 12:19:51 -0400'
  date_gmt: '2013-03-18 12:19:51 -0400'
  content: '[...] Programmatically Add ListViewWebPart with Customized View | Of Ones
    and Zeros [...]'
- id: 15913
  author: cheap hollister
  author_email: eanytpd@gmail.com
  author_url: http://app.virtualtravelevents.com/Images/cheap-hollister/
  date: '2014-10-19 04:19:16 -0400'
  date_gmt: '2014-10-19 04:19:16 -0400'
  content: "To purchase the glasses, you must functioning with an Oakley-affiliated
    eye doctor, such as Dr. Beckwith of Austin County say so Associates or any one
    of the proper opticians located at the vision center that can bear your prescription
    also order the frame further lenses from Oakley.\r\ncheap hollister http://app.virtualtravelevents.com/Images/cheap-hollister/"
- id: 15915
  author: hogan stivali
  author_email: djazvgnmj@gmail.com
  author_url: http://www.lys.it/FCKeditor/editor/css/images/52cqu61e.asp
  date: '2014-10-19 05:22:13 -0400'
  date_gmt: '2014-10-19 05:22:13 -0400'
  content: "Oakley, the famous brand of sunglasses offers sunglasses to wear the most
    amazing art that are made from top quality materials and the latest technologies.
    Oakley sunglasses Top rates of men are often seen as a fad. These sunglasses often
    promise of optical centers of excellence that we glorify any type of clothing
    you wear.\r\nhogan stivali http://www.lys.it/FCKeditor/editor/css/images/52cqu61e.asp"
- id: 15916
  author: gucci las vegas
  author_email: sfpherdu@gmail.com
  author_url: http://www.mhusa.com/tools/j2lfhmye.asp
  date: '2014-10-19 05:36:08 -0400'
  date_gmt: '2014-10-19 05:36:08 -0400'
  content: "The clarity you get from the lenses is excellent and would serve well
    for cyclists, runners and the like.I have seen people selling RayBan on ebay or
    other channels for less than the retail price and yet they sell the real ones.\r\ngucci
    las vegas http://www.mhusa.com/tools/j2lfhmye.asp"
- id: 15917
  author: louis vuitton bags outlet store
  author_email: uykdyrkjw@gmail.com
  author_url: http://www.bleubelle.com/database/3k8y31fg/louis-vuitton-bags-outlet-store-lgjdv.html
  date: '2014-10-19 06:26:39 -0400'
  date_gmt: '2014-10-19 06:26:39 -0400'
  content: "Usually if you take your sunglasses to a lens crafter store or a Sunglass
    Hut store , then you get more accurate information.Beam ban aviator is developed
    to protect pilots eyes from everlasting damages as a result of the harmful sunlight
    when flying.\r\nlouis vuitton bags outlet store http://www.bleubelle.com/database/3k8y31fg/louis-vuitton-bags-outlet-store-lgjdv.html"
- id: 15919
  author: Canada Goose Danmak
  author_email: wlqjyc@gmail.com
  author_url: http://www.karindyhr.dk/karindyhr.asp
  date: '2014-10-19 07:24:45 -0400'
  date_gmt: '2014-10-19 07:24:45 -0400'
  content: "Ugg Schoenen are constructed getting trendy and warm.\r\nCanada Goose
    Danmak http://www.karindyhr.dk/karindyhr.asp"
- id: 19355
  author: Chaussures Femme
  author_email: frviyzkdz@gmail.com
  author_url: http://www.enciclopediapr.org/images/louboutinfr.html
  date: '2014-12-08 15:15:31 -0500'
  date_gmt: '2014-12-08 15:15:31 -0500'
  content: "Il existe une idée que seules les femmes étaient folles au sujet de la
    chaussure et de l'amour pour avoir une armoire pleine de chaussures pour différents
    types d'occasions et panoplies, comme les hommes sont également friands de cela.\r\nChaussures
    Femme http://www.enciclopediapr.org/images/louboutinfr.html"
- id: 19356
  author: Moncler Sito Ufficiale
  author_email: ivfaftgpf@gmail.com
  author_url: http://www.parcodelserio.it/
  date: '2014-12-08 15:15:31 -0500'
  date_gmt: '2014-12-08 15:15:31 -0500'
  content: "The Moncler jackets can also be bought online from different websites.
    However, you must make sure that you have confirmed the authenticity of the website
    before making any transaction, so as to protect yourself from any kind of fraudulent
    behavior.\r\nMoncler Sito Ufficiale http://www.parcodelserio.it/"
- id: 20074
  author: Moncler Outlet Online
  author_email: dwsvmbfo@gmail.com
  author_url: http://www.artinprogress.it
  date: '2014-12-16 17:38:46 -0500'
  date_gmt: '2014-12-16 17:38:46 -0500'
  content: "These Moncler jackets are suitable for men and not other jackets to make
    you looks fashionable. Moncler coats are also available for navy blues, greys,
    pink for little girls.\r\nMoncler Outlet Online http://www.artinprogress.it"
---
<p>There are several approaches to adding a ListViewWebPart to a page floating around the Interwebs, and I do believe over the course of the past week I have tried every one of them!  What I intend to do here is to cut to the chase and present the method that worked reliably for my purposes.</p>
<h3>Scenario</h3>
<p>As the title suggests, the scenario is that we are adding a ListViewWebPart to a page, utilizing one of the current list views as a "template", but making some changes for the purposes of this web part.</p>
<h3>Solution</h3>
<p>I recommend hitting the "view source" button on the syntax highlighter, I really need to switch to a wider blog template :-(.  In any event, here is the solution that I employed, I added numerous comments to describe why things were being done.  Hopefully it saves someone some time.</p>
<p>{% highlight c# %}
SPLimitedWebPartManager limitedWebPartManager = null;
ListViewWebPart wp = null;
try
{
    // assume that you have a limitedWebPartManager variable containing an
    // instance of a SPLimitedWebPartManager class.
    // also assume that you have a list variable containing a reference to the
    // SPList that you are pointing this ListViewWebPart at.
    // create an instance of the ListViewWebPart
    wp = new ListViewWebPart();
    // convert the list GUID to a string, must include braces (ToString("B")) and be in uppers (ToUpper())
    wp.ListName = list.ID.ToString("B").ToUpper();
    // optionally set the title of the web part
    wp.Title = "I Love List Views";
    // add the web part to the limited web part manager.  when you do this, a "hidden" view will be created
    // on the list referenced by the list variable.  we will later get a reference to this hidden view and bend it
    // to our will.
    limitedWebPartManager.AddWebPart(wp, "whatever web part zone you want to add it to", 1); // the 1 is the index within the zone
    // you need to update the list because a view was just added to it
    list.Update();
    // now that the web part has been added we need to get a fresh reference to it from the limitedWebPartManager.
    // there are plenty of great ways to do this, in this example i will be using the low-tech approach of enumerating the
    // WebParts collection and checking for the type and title that matches our part.  i am quite positive there are more
    // efficient ways of doing this, but this code gets called exactly once every couple months, so efficiency isn't worth
    // the extra development cycles
    foreach (System.Web.UI.WebControls.WebParts.WebPart webPart in limitedWebPartManager.WebParts)
    {
        // check to see if the type of the web part is ListViewWebPart, and if so, check if the title matches our guy.
        if (webPart is ListViewWebPart &amp;amp;&amp;amp; webPart.Title.Equals("I Love List Views"))
        {
            // cast the web part to a ListViewWebPat so we can start to tweak its properties
            var listViewWebPart = webPart as ListViewWebPart;
            // here is some of the magic.  the web part now has its ViewGuid property populated which
            // contains the Guid of the hidden view.  we get a reference to it here.
            var view = list.Views[new Guid(listViewWebPart.ViewGuid)];
            // here we grab a reference to a template view.  this may be the default view of the list,
            // or maybe you have another view that you created that you want to use.  you don't have to
            // do this, but in this scenario i wanted to copy the filter and sort settings from an existing view.
            var templateView = list.Views["Name Of Template View"];
            // now we drop all of the view fields in the hidden view
            view.ViewFields.DeleteAll();
            // now we are going to go through a string array and add each of the strings to the view fields collection.  again,
            // you don't have to do this, but if you want to change what columns are displayed in your ListViewWebPart, you will
            // need to muck with the ViewFields of the view.
            Array.ForEach(new string[] { "First Name", "Last Name", "Address" }, f => view.ViewFields.Add(f));
            // here we copy the Query straight from the templateView.  if you didn't have a templateView you could always
            // just create an SPQuery instance and assign it to the view.Query property.  no points will be taken off for doing that.
            view.Query = templateView.Query;
            // update our hidden view, and bask in the awesomeness of our customized ListViewWebPart
            view.Update();
        }
    }
}
finally
{
    // do some fun cleanup of disposable items.  if you are wondering about the .Web.Dispose() bit look for my
    // blog article on the memory leaks in the SPLimitedWebPartManager.
    if (limitedWebPartManager != null)
    {
        if (limitedWebPartManager.Web != null)
        {
            limitedWebPartManager.Web.Dispose();
        }
        limitedWebPartManager.Dispose();
    }
    if (wp != null)
    {
        wp.Dispose();
    }
    // i probably missed some .Dispose()s since I cobbled this code together in Wordpress and not Visual Studio
}
{% endhighlight %}</p>
